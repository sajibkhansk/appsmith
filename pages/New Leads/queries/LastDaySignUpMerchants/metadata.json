{
  "gitSyncId": "67a78c88af45f24f85e95b40_f9e3595b-f40c-43e0-aaa3-e8e9dd704e04",
  "id": "New Leads_LastDaySignUpMerchants",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH summarizer AS (\n    SELECT \n        m.id,\n        m.name,\n        m.phone,\n        DATE(m.created_at) AS merchant_created_at,\n        m.first_order_date,\n        m.last_order_date,\n        m.active_payment_method,\n        COUNT(s.id) AS store_count\n    FROM remote_hermes.merchants m\n    LEFT JOIN remote_hermes.stores s ON s.merchant_id = m.id\n\t\tleft join remote_hermes.merchant_users mu on mu.merchant_id = m.id\n    WHERE  date(m.created_at) between {{startDate.formattedDate}} AND  {{endDate.formattedDate}}\n      AND NOT EXISTS (\n          SELECT 1\n          FROM new_onboards nm\n          WHERE nm.merchant_id is null and  nm.phone = m.phone\n      )\n    GROUP BY m.id, m.name, m.phone, m.created_at, m.first_order_date, m.last_order_date, m.active_payment_method\n    ORDER BY store_count DESC\n)\nSELECT \n    *,\n    CASE \n        -- Info Pending: active_payment_method IS NULL or store_count = 0, and first_order_date is NULL\n        WHEN (active_payment_method IS NULL OR store_count = 0) \n             AND first_order_date IS NULL\n        THEN 'Info Pending'\n        \n        -- First Order Pending: active_payment_method IS NOT NULL, store_count <> 0, and first_order_date IS NOT NULL\n        WHEN active_payment_method IS NOT NULL \n             AND store_count <> 0 \n             AND first_order_date IS NULL\n        THEN 'First Order Pending'\n        \n        -- Incubation: All other conditions\n        ELSE 'Incubation'\n    END AS account_status\nFROM summarizer;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "hermes-write-db-prod",
      "isAutoGenerated": false,
      "name": "hermes-write-db-prod",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": true,
    "name": "LastDaySignUpMerchants",
    "pageId": "New Leads",
    "userSetOnLoad": false
  }
}