{
  "gitSyncId": "67854afe8f01ef5977743d0e_32c4d232-01ce-4f72-83ef-1d54b4eafa89",
  "id": "Tracker_dynamicQuery",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH hunts AS (\n\tSELECT \n\tno.id,\n\tno.phone, \n\tm.name AS merchant_name,\n\tm.id AS merchant_id,\n\tno.business_name,\n\tno.business_owner_name,\n\tmu.name AS merchant_user_name,\n\tmu.email as email,\n\tno.onboard_type, \n\tno.business_team_user_id, \n\tm.first_order_date, \n\tm.active_payment_method,\n\tno.status,\n\taccount_status,\n\tCOUNT(s.id) AS store_count,\n\ttext_status,\n\tcall_status,\n\tcnr_status,\n\tdate(no.assigned_at) as assigned_at\n\n\tFROM new_onboards no\n\tLEFT JOIN remote_hermes.merchants m ON m.phone = no.phone\n\tLEFT JOIN remote_hermes.stores s ON s.merchant_id = m.id\n\tLEFT JOIN remote_hermes.merchant_users mu ON mu.merchant_id = m.id\n\twhere mu.type = 'owner'\n\tand no.created_at >= '2025-10-01'\n\tGROUP BY \n\tno.id, no.phone, m.name, m.id, no.business_name, no.business_owner_name,\n\tmu.name,mu.email, no.onboard_type, no.business_team_user_id, m.first_order_date, \n\tm.active_payment_method, account_status, text_status\n),\ntracker AS (\n\tSELECT \n\th.*, \n\tm.id AS final_merchant_id,\n\tCASE\n    WHEN h.merchant_id IS NOT NULL AND h.first_order_date IS NOT NULL THEN 'Incubation'\n    WHEN m.id IS NULL THEN 'Registration Pending'\n    WHEN m.id IS NOT NULL \n         AND (h.active_payment_method IS NULL OR h.store_count = 0) \n         AND h.first_order_date IS NULL THEN 'Info Pending'\n    WHEN m.id IS NOT NULL \n         AND h.active_payment_method IS NOT NULL \n         AND h.store_count <> 0 \n         AND h.first_order_date IS NULL THEN 'First Order Pending'\n    ELSE h.account_status\n\tEND AS final_status\n\tFROM hunts h\n\tLEFT JOIN remote_hermes.merchants m ON h.phone = m.phone\n)\n\nSELECT \n    * \nFROM tracker\nWHERE final_status = '{{this.params.status}}'\nAND business_team_user_id = '{{this.params.user_id.toString()}}'\nand (status <> 'Inactive' or status is null)\norder by id desc;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 100000000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "hermes-write-db-prod",
      "isAutoGenerated": false,
      "name": "hermes-write-db-prod",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": false,
    "name": "dynamicQuery",
    "pageId": "Tracker",
    "userSetOnLoad": false
  }
}