{
  "gitSyncId": "67854afe8f01ef5977743d0e_10b7c233-3fd0-492b-880e-48dd000c2a1b",
  "id": "Tracker_merchantsCurrentStatus",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH summarizer AS (\n    SELECT \n        m.id,\n        m.name,\n        m.phone,\n        DATE(m.created_at) AS merchant_created_at,\n        m.first_order_date,\n        m.last_order_date,\n        m.active_payment_method,\n        COUNT(s.id) AS store_count\n    FROM remote_hermes.merchants m\n    LEFT JOIN remote_hermes.stores s ON s.merchant_id = m.id\n    WHERE m.created_at >= CURRENT_DATE - INTERVAL '1 day'\n      AND m.created_at < CURRENT_DATE\n      AND NOT EXISTS (\n          SELECT 1\n          FROM new_onboards nm\n          WHERE nm.phone = m.phone\n      )\n    GROUP BY m.id, m.name, m.phone, m.created_at, m.first_order_date, m.last_order_date, m.active_payment_method\n    ORDER BY store_count DESC\n)\nSELECT \n    *,\n    CASE \n        -- Info Pending: active_payment_method IS NULL or store_count = 0, and first_order_date is NULL\n        WHEN (active_payment_method IS NULL OR store_count = 0) \n             AND first_order_date IS NULL\n        THEN 'Info Pending'\n        \n        -- First Order Pending: active_payment_method IS NOT NULL, store_count <> 0, and first_order_date IS NOT NULL\n        WHEN active_payment_method IS NOT NULL \n             AND store_count <> 0 \n             AND first_order_date IS NULL\n        THEN 'First Order Pending'\n        \n        -- Incubation: All other conditions\n        ELSE 'Incubation'\n    END AS account_status\nFROM summarizer;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 9999982
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "hermes-write-db-prod",
      "isAutoGenerated": false,
      "name": "hermes-write-db-prod",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [],
    "executeOnLoad": false,
    "name": "merchantsCurrentStatus",
    "pageId": "Tracker",
    "userSetOnLoad": false
  }
}